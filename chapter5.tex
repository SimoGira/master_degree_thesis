\chapter{Experimental Results} \label{chap:experimental-results}
Now it will be presented the experimental results obtained using the methodology explained in the previous chapter.
First it will be described the setup Hardware and Software used during the experiments. Next, it will be explained how the methodology can be applied considering a typical robotic system developed for mobile robot navigation in a warehouse.


\section{Setup}
The main technicals specifications of the \textit{Host} are shown in table \ref{tab:tech-specs-host}.

\begin{table}[ht!]
	\centering
	\begin{tabular}{|l|l|}
		\hline
		\rowcolor{Gray}
		Hardware 			& Model 												\\
		\hline
		Processor 			& Intel(R) Core(TM) i5-7400 CPU @ 3.00GHz				\\
		Operating System 	& 18.04.1-Ubuntu										\\
		Storage 			& SATA 500GiB											\\
		Memory				& 16GiB													\\
		GPU					& NVIDIA GeForce GTX 980								\\
		\hline
		\rowcolor{Gray}
		Software 			& Version 												\\
		\hline
		OpenCV				& 3.4.7													\\
		CUDA				& 10.0													\\
		ROS					& Melodic Moreina										\\
		\hline
	\end{tabular}
	\caption{Technical specifications of the Host \label{tab:tech-specs-host}}
\end{table}

\section{Mobile robots}


%TODO setup sofware


\subsection{Architecture at L1}
At this architecture level we put a whole ROS-based system on a single Intel x86 powered machine that we will conventionally call \textit{Host}. 
This is the simplest and the most common architecture used by robotics researches. As shown in figure \ref{fig:l1archexp}, in this case there are two main ROS nodes that communicate between them. Specifically speaking, there are both ORB-SLAM2, explained in the previous chapter, and a hybrid motion planner (VOVD \cite{VOVD}). Both applications are running as ROS nodes to perform a mobile robot 2D navigation task.

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{images/L1-arch}
	\caption{L1 architecture}
	\label{fig:l1archexp}
\end{figure}

Because of the most used robotics platforms used today support the Melodic Morenia \cite{rosmelodic} version of ROS, and because of VOVD was written with the Kinetic version, it has been decided to convert VOVD in the relative Melodic ROS version. This task required a redefinition of some functions related to the ROS \textit{tf2} package \cite{tfros} due to the deprecation of the \textit{tf} package functions previously used. 
Another modification done talking about VOVD is related to the 3D map used by Gazebo \cite{Gazebo}. The problem was that it came with a featureless map generated from an URDF file, and because of ORB-SLAM2 properly works only if some features are detected during its execution, it has been necessary to add a material to the 3D model of the map.
Talking about ORB-SLAM2, it comes already provided with the necessaries functions to run in a ROS environment, thus no others operations have been required to complete our first architecture level.
%TODO a questo livello di architettura è possbile fare una verifica funzionale del sistema...



\subsection{Architecture at L2} %TODO Work in progress
Another common architecture in robotics, involves the distribution of ROS nodes on different hardware platforms (e.g. NVIDIa Jetson or Raspberry). 
This step requires the split of our system in two parts: \textit{Host} (with Gazebo simulator) and \textit{Device/s} (robot navigation node/s). For this purpose, due to the several interconnected nodes, each of which having many parameters, it is recommanded create a roslaunch file  using the \textit{machine tag}. These tags allow control over which nodes run on which machines, for load-balancing and bandwidth management. Fig. \ref{fig:l2arch} show an example of this configuration. At this architecture level the main focus is on the communication between the \textit{Host}, that act as Master, and the other external nodes that represent the slaves. It is important to verify that the system continue working properly and that the Network doesn't become a bottleneck. For example, if we need to transfer a stream of images from one ROS nodes to another that is running on different machine, we should compress the images before send them over the network. In this way we avoid to saturate the bandwidth of the network.

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{images/L2-arch}
	\caption{L2 architecture}
	\label{fig:l2arch}
\end{figure}




\subsection{Architecture at L3}	%TODO questo non lo abbiamo fatto ma lo mettiamo lo stesso.
Finally the last typical architecture level is composed by \textit{Host}, \textit{Device/s } and  \textit{Robot/s}. If the previous step have been properly done, this one should be completely 
transparent with respect to the entire system. 
As we can see in Fig. \ref{fig:l3arch}, the simulator has been removed from the \textit{Host} and it is replaced by the real robot, on which one or more embedded devices are attached.
To achieve this goal ... 
%TODO chiedere a piccinelli qual'è la modifica da fare per eseguire i comandi sul robot anziché sul simulatore


\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{images/L3-arch}
	\caption{L3 architecture}
	\label{fig:l3arch}
\end{figure}


\section{Deployment from the cloud to the edge} % How to prepare an application for edge computing in Kubeedge?
As mentioned in \ref{kubeedgebackground}, Kubeedge is built upon Kubernetes and provides fundamental infrastructure support for network, app. deployment and metadata synchronization between cloud and edge. As we know, Kubernetes uses containers to run isolated, packaged applications across its cluster nodes. To run on Kubernetes, your applications must be encapsulated in one or more container images and executed using a container runtime like Docker. While containerizing your components is a requirement for Kubernetes, it also allow easy scaling and management. For instance, containers provide isolation between the application environment and the external host system, support a networked, service-oriented approach to inter-application communication, and typically take configuration through environmental variables and expose logs written to standard error and standard out. Containers themselves encourage process-based concurrency and help maintain dev/prod parity by being independently scalable and bundling the process’s runtime environment. These characteristics make it possible to package your applications so that they run smoothly on Kubernetes. In this section it will described the process used in our project to prepare both VOVD and ORB-SLAM2 applications for the edge computing through the support of Kubeedge.


\subsection{VOVD at the edge}
%TODO Dockerfile di VOVD 
%TODO Problemi in fase di building del container --> ROS network comunication


\subsection{ORB-SLAM2 at the edge}
%TODO Dockerfile di ORB_SLAM2 
%TODO Problemi in fase di building del container --> ROS + GPU (TRT)

\section{The whole system on Kubeedge}
%TODO Once we have containerized our applications we are ready to deploy them from the cloud to the edge with kubeedge: L1, L2, L3 ?!.



\section{Discussion}

















































\subsection{Hybrid local/global planner}



\section{Results}
\begin{table}[ht!]
	\resizebox{\linewidth}{!}{%
		\begin{tabular}{|l|c|c|c|c|c|c|c|c|c|} 
			\hline
			\hspace{3mm} Setup & Odom VOVD (ms) & Track Pipe (ms) & Decompression (ms) & Frame Elaboration (ms) & Feature Extraction (ms) & Supported (FPS)  \\ 
			\hline
			\rowcolor{Gray}
			\multicolumn{7}{|c|}{Performance Measurement: camera 10 Hz}  \\
			\hline
			orb(j1)     					 &	-  		  & 43.41 & 13.08  & 49.21 & 43.62 & 20.32   \\ \hline
			vovd(j1)       	 			  & 1.70  & -     	 	 & -    		 & -     		& -    		   & -     		  \\ \hline
			(orb;vovd)(j1)      	& 2.58 	& 73.49 & 18.69  & 62.70 & 54.76  & 13.61 	 \\ \hline
			(orb(j1);vovd(j2))  & 1.60 	& 49.81 & 13.53  & 49.25 & 43.01  & 20.08	 \\ \hline
			\rowcolor{Gray}
			\multicolumn{10}{|c|}{Performance Measurement: camera 20 Hz}  \\
			\hline
			orb(j1)     					 &   -  	 & 54.82 & 14.47 & 49.40 & 44.35 &18.24 	 \\ \hline
			vovd(j1)       	 			  & 1.70 & -     		& -     	   & -     		 & -     		& -     			 \\ \hline
			(orb;vovd)(j1)      	& 2.85 & 93.15 & 23.96 & 67.99 & 60.41 & 10.74 		\\ \hline
			(orb(j1);vovd(j2))  & 1.60 & 56.20 & 14.00 & 49.32 & 43.95 & 17.79 		\\ \hline
			\rowcolor{Gray}
			\multicolumn{7}{|c|}{Kubeedge - Performance Measurement: camera 10 Hz}  \\
			\hline
			orb(j1)     					& -    		 & 47.28 & 12.78  & 40.52 & 36.02 & 21.15 	 \\ \hline
			vovd(j1)       	 			  & 1.30 & -     		& -     	   & -     		  & -     		 & -     		   \\ \hline
			(orb;vovd)(j1)      	& 1.40 & 82.47 & 15.10  & 53.54 & 48.09 & 12.12		\\ \hline
			(orb(j1);vovd(j2))  & 1.38 & 50.83 & 13.98  & 43.80 & 38.04 & 19.67		\\ \hline
			\rowcolor{Gray}
			\multicolumn{7}{|c|}{Kubeedge - Performance Measurement: camera 20 Hz}  \\
			\hline
			orb(j1)     					 & -    	 & 50.20 & 16.20 & 42.16 & 34.82 & 19.92  \\ \hline
			vovd(j1)       	 			  & 1.21 & -			& -     	   & -     		 & -     		& -     		\\ \hline
			(orb;vovd)(j1)      	& 1.43 & 70.54 & 15.02  & 55.60 & 50.24 & 14.18  \\ \hline
			(orb(j1);vovd(j2))  & 1.26 & 58.14 & 13.52  & 42.34 & 37.17 & 17.20  \\ \hline
	\end{tabular}}
	\caption{Performance Measurement\label{tab:Performance-Measurement}}
\end{table}





\begin{table}[hbt]
	\begin{tabularx}{\linewidth}{@{}l*{7}{C}c@{}}
		\toprule
		\hline
		Setup              & Odom (ms) & Track Pipe (ms) & Dec. (ms) & Frame Elab. (ms) & Feature Ext.(ms) & Supp. (FPS) \\
		\hline
		\rowcolor{Gray}
		\multicolumn{7}{|c|}{Performance Measurement: camera 10 Hz}                                                                                                                                           \\
		\hline
		orb(j1)            & -             & 43.41          & 13.08             & 49.21                 & 43.62                  & 20.32           \\ \hline
		vovd(j1)           & 1.70          & -              & -                 & -                     & -                      & -               \\ \hline
		(orb;vovd)(j1)     & 2.58          & 73.49          & 18.69             & 62.70                 & 54.76                  & 13.61           \\ \hline
		(orb(j1);vovd(j2)) & 1.60          & 49.81          & 13.53             & 49.25                 & 43.01                  & 20.08           \\ \hline
		\rowcolor{Gray}
		\multicolumn{7}{|c|}{Performance Measurement: camera 20 Hz}                                                                                                                                           \\
		\hline
		orb(j1)            & -             & 54.82          & 14.47             & 49.40                 & 44.35                  & 18.24           \\ \hline
		vovd(j1)           & 1.70          & -              & -                 & -                     & -                      & -               \\ \hline
		(orb;vovd)(j1)     & 2.85          & 93.15          & 23.96             & 67.99                 & 60.41                  & 10.74           \\ \hline
		(orb(j1);vovd(j2)) & 1.60          & 56.20          & 14.00             & 49.32                 & 43.95                  & 17.79           \\ \hline
		\rowcolor{Gray}
		\multicolumn{7}{|c|}{Kubeedge - Performance Measurement: camera 10 Hz}                                                                                                                                \\
		\hline
		orb(j1)            & -             & 47.28          & 12.78             & 40.52                 & 36.02                  & 21.15           \\ \hline
		vovd(j1)           & 1.30          & -              & -                 & -                     & -                      & -               \\ \hline
		(orb;vovd)(j1)     & 1.40          & 82.47          & 15.10             & 53.54                 & 48.09                  & 12.12           \\ \hline
		(orb(j1);vovd(j2)) & 1.38          & 50.83          & 13.98             & 43.80                 & 38.04                  & 19.67           \\ \hline
		\rowcolor{Gray}
		\multicolumn{7}{|c|}{Kubeedge - Performance Measurement: camera 20 Hz}                                                                                                                                \\
		\hline
		orb(j1)            & -             & 50.20          & 16.20             & 42.16                 & 34.82                  & 19.92           \\ \hline
		vovd(j1)           & 1.21          & -              & -                 & -                     & -                      & -               \\ \hline
		(orb;vovd)(j1)     & 1.43          & 70.54          & 15.02             & 55.60                 & 50.24                  & 14.18           \\ \hline
		(orb(j1);vovd(j2)) & 1.26          & 58.14          & 13.52             & 42.34                 & 37.17                  & 17.20           \\ \hline
		\bottomrule
	\end{tabularx}
	\caption{\label{tab:Performance-Measurement2}Performance Measurement.}
\end{table}







%%%%%%%%%%%%%%%%%%%%%%5
\clearpage
\thispagestyle{empty}